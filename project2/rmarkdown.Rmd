---
title: "Does Race type affects a resident's life"
author: "Hu Xiangkun"
date: "2014年10月20日"
output: html_document
---

I will study the problem that whether a resident's race affects his/her life. In this project, I use the data from General Social Survey (GSS), which conducted between 1972 - 2012 from the residents of United States. The dataset names "gss". I will figure this out by contrasting the education and income level between the white and black race.

First let's load the dataset as below:

```{r}
#The gss data can also be loaded from "http://d396qusza40orc.cloudfront.net/statistics/project/gss.Rdata"
load("gss.Rdata")
```

The gss dataset has 114 variables, there are 3 variable I care about here are "race", "incom16" and "degree", so let's get the subset:

```{r}
#This project only care about race, income and eduction level
gss_p = na.omit(gss[, c("race", "incom16", "degree")])
```

Let's see the summary of this subset:

```{r}
summary(gss_p)
```

The summary infomation shows that the main race in the USA are "White" and "Black", and there are 6 types of income level and 5 types of eduction level. So here I only concern "White" and "Black" race for this study.

```{r}
#Only concern about "White" and "Black" race
data = subset(gss_p, gss_p$race == "White" | gss_p$race == "Black")
summary(data)
```

So next I will use hypothsis test and confidence interval to test whether there is a difference between White and Black in income and eduction level.

Income
===========
There are 6 income levels, I will study them one by one. As the method in study different types are the same, so I will use the income level "Far Below Average" as an example.

#### Far Below Average
Using **pw** and **pb** to represent the probabilty of the resident has a income far below the average. Cause I will use hypothsis test, now I state the hypothsis below:

**H0: Race has no effect in income level far below average, the two probabilties are equal, i.e. pw = pb** 

**HA: Race type does has an effect, i.e. pw ≠ pb**

First check the conditions.

```{r}
#Subset of data with income far below average
data_income_farbelow = subset(data, data$incom16 == "Far Below Average")
nw = nrow(subset(data_income_farbelow, data_income_farbelow$race == "White"))
nb = nrow(subset(data_income_farbelow, data_income_farbelow$race == "Black"))
nw
nb
```

Since the data are collect randomly, and the number of "White" and "Black" are all greater than 10, so the success-failure condition holds. We can say that the observations are all independent and nearly normal.

Now let's calculate the point estimate of **pw-pb**:

```{r}
#Point estimate of pw and pb.
pw_e = nw / nrow(data)
pb_e = nb / nrow(data)
#Point estimate of pw-pe
pe = pw_e - pb_e
#standard error
se = sqrt(pw_e*(1 - pw_e)/nw + pb_e*(1 - pb_e)/nb)
#confidence interval using 95% confidence level
c(pe-1.96*se, pe+1.96*se)
#p-value using 5% significance level
2*(1 - pnorm(pe/se))
```

We can see that the p-value is extremely samll so we reject the null hypothsis. And the confidence interval agrees the result of hypothsis test. I have 95% confidence that the percentage of the "White" have income far below the average is 0.01566731 to 0.04247449 higher than "Black" in the population.

In fact, I can write a function that can be used in all the income levels. Here is the function:

```{r}
income_evaluate = function(incomelevel = "Far Below Average") {
  #subset of the given income level
  subdata = subset(data, data$incom16 == incomelevel)
  nw = nrow(subset(subdata, subdata$race == "White"))
  nb = nrow(subset(subdata, subdata$race == "Black"))
  #point estimate of the pw-pb
  pw_e = nw / nrow(data)
  pb_e = nb / nrow(data)
  pe = pw_e - pb_e
  #standard error
  se = sqrt(pw_e*(1 - pw_e)/nw + pb_e*(1 - pb_e)/nb)
  #confidence interval using 95% confidence level
  print(paste("Con"))
  cat("(",as.character(pe-1.96*se),",")
  print(c(pe-1.96*se, pe+1.96*se))
  #p-value using 5% significance level
  print(2*(1 - pnorm(pe/se)))
}
```

```{r}
income_evaluate("Far Below Average")
```



